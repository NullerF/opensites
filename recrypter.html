<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Encryptor/Decryptor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --card-bg: #ffffff;
            --header-bg: #e9ecef;
        }
        
        .dark-theme {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --header-bg: #2d2d2d;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            padding-bottom: 60px;
        }
        
        .card {
            background-color: var(--card-bg);
            border-color: rgba(255, 255, 255, 0.125);
        }
        
        .card-header {
            background-color: var(--header-bg);
        }
        
        .language-switcher {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        
        .theme-switcher {
            position: absolute;
            top: 10px;
            right: 130px;
        }
        
        .github-icon, .telegram-icon {
            position: fixed;
            bottom: 20px;
            font-size: 2rem;
            z-index: 1000;
        }
        
        .github-icon {
            left: 20px;
            color: #6e5494;
        }
        
        .telegram-icon {
            right: 20px;
            color: #0088cc;
        }
        
        .symbol-table {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .preset-btn {
            margin: 2px;
        }
        
        .btn-group {
            margin-bottom: 10px;
        }
        
        .mode-indicator {
            font-size: 0.9rem;
            margin-left: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            background-color: #6c757d;
            color: white;
        }
        
        .mode-encrypt {
            background-color: #198754;
        }
        
        .mode-decrypt {
            background-color: #fd7e14;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="theme-switcher">
            <button id="themeToggle" class="btn btn-outline-secondary">
                <i class="bi bi-moon-fill"></i>
            </button>
        </div>

        <div class="language-switcher">
            <div class="btn-group">
                <button class="btn btn-outline-primary active" data-lang="ru">RU</button>
                <button class="btn btn-outline-secondary" data-lang="en">EN</button>
            </div>
        </div>

        <h1 class="text-center mb-4" data-i18n="title">Шифратор/Дешифратор текста</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span data-i18n="inputText">Исходный текст</span>
                        <button id="clearInput" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> <span data-i18n="clear">Очистить</span>
                        </button>
                    </div>
                    <div class="card-body">
                        <textarea id="inputText" class="form-control" rows="6" placeholder="Введите текст для шифрования..."></textarea>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <span data-i18n="resultText">Результат</span>
                            <span id="modeIndicator" class="mode-indicator d-none"></span>
                        </div>
                        <button id="clearOutput" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-x-circle"></i> <span data-i18n="clear">Очистить</span>
                        </button>
                    </div>
                    <div class="card-body">
                        <textarea id="outputText" class="form-control" rows="6" readonly></textarea>
                    </div>
                </div>
                
                <div class="d-grid gap-2">
                    <div class="btn-group">
                        <button id="analyzeBtn" class="btn btn-primary" data-i18n="analyze">Анализировать текст</button>
                        <button id="encryptBtn" class="btn btn-success" disabled data-i18n="encrypt">Зашифровать</button>
                        <button id="decryptBtn" class="btn btn-warning" disabled data-i18n="decrypt">Дешифровать</button>
                    </div>
                    <button id="saveTableBtn" class="btn btn-info" disabled data-i18n="saveTable">Сохранить таблицу</button>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span data-i18n="symbolTable">Таблица замены символов</span>
                        <div class="btn-group">
                            <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" data-i18n="presets">
                                Готовые таблицы
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item preset-btn" data-preset="alchemy">Алхимический шифр</a></li>
                                <li><a class="dropdown-item preset-btn" data-preset="clear">Очистить таблицу</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info" role="alert" data-i18n="decryptHelp">
                            Для дешифрования убедитесь, что таблица замены соответствует той, что использовалась при шифровании.
                        </div>
                        <div class="symbol-table">
                            <table class="table table-striped table-sm">
                                <thead>
                                    <tr>
                                        <th data-i18n="original">Исходный</th>
                                        <th data-i18n="replace">Замена</th>
                                    </tr>
                                </thead>
                                <tbody id="symbolTableBody">
                                    <!-- Table will be populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <a href="https://github.com/NullerF/opensites" target="_blank" class="github-icon">
        <i class="bi bi-github"></i>
    </a>

    <a href="https://t.me/NullerF" target="_blank" class="telegram-icon">
        <i class="bi bi-telegram"></i>
    </a>

    <script>
        // Translations
        const translations = {
            ru: {
                title: "Шифратор/Дешифратор текста",
                inputText: "Исходный текст",
                resultText: "Результат",
                analyze: "Анализировать текст",
                encrypt: "Зашифровать",
                decrypt: "Дешифровать",
                saveTable: "Сохранить таблицу",
                symbolTable: "Таблица замены символов",
                presets: "Готовые таблицы",
                original: "Исходный",
                replace: "Замена",
                clear: "Очистить",
                placeholder: "Введите текст для шифрования...",
                encryptedText: "Зашифрованный текст",
                decryptedText: "Дешифрованный текст",
                decryptHelp: "Для дешифрования убедитесь, что таблица замены соответствует той, что использовалась при шифровании."
            },
            en: {
                title: "Text Encryptor/Decryptor",
                inputText: "Input Text",
                resultText: "Result",
                analyze: "Analyze Text",
                encrypt: "Encrypt",
                decrypt: "Decrypt",
                saveTable: "Save Table",
                symbolTable: "Symbol Replacement Table",
                presets: "Preset Tables",
                original: "Original",
                replace: "Replace",
                clear: "Clear",
                placeholder: "Enter text for encryption...",
                encryptedText: "Encrypted text",
                decryptedText: "Decrypted text",
                decryptHelp: "For decryption, make sure the substitution table matches the one used for encryption."
            }
        };

        // Predefined substitution tables
        const presetTables = {
            alchemy: {
                'a': '!',
                'b': '@',
                'c': '#',
                'd': '$',
                'e': '%',
                'f': '^',
                'g': '&',
                'h': '*', 
                'i': '(',
                'j': ')',
                'k': '/',
                'l': '?',
                'm': '.',
                'n': ',',
                'o': '8',
                'p': ';',
                'q': ':',
                'r': ']',
                's': '{',
                't': '[',
                'u': '}',
                'v': '=',
                'w': '+',
                'x': '`',
                'y': '-',
                'z': '~'
                
            }
        };

        // Global variables
        let currentLang = 'ru';
        let substitutionTable = {};
        let reverseTable = {};
        let isDarkTheme = false;
        let lastOperation = null; // 'encrypt' or 'decrypt'

        // Function to change language
        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Update language buttons
            document.querySelectorAll('.language-switcher .btn').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                    btn.classList.remove('btn-outline-secondary');
                    btn.classList.add('btn-outline-primary');
                } else {
                    btn.classList.remove('active');
                    btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-outline-secondary');
                }
            });
        }

        // Function to toggle theme
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            if (isDarkTheme) {
                document.body.classList.add('dark-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="bi bi-sun-fill"></i>';
            } else {
                document.body.classList.remove('dark-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="bi bi-moon-fill"></i>';
            }
            // Save theme preference to localStorage
            localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
        }

        // Function to detect user's language based on IP
        function detectLanguage() {
            // In a real application, you would use an IP geolocation API
            // For this example, we'll use browser language settings
            const browserLang = navigator.language || navigator.userLanguage;
            
            if (browserLang.startsWith('ru')) {
                return 'ru';
            } else {
                return 'en';
            }
        }

        // Function to analyze text and create symbol table
        function analyzeText() {
            const text = document.getElementById('inputText').value;
            if (!text) {
                alert(currentLang === 'ru' ? 'Введите текст для анализа!' : 'Please enter text to analyze!');
                return;
            }

            const uniqueChars = [...new Set(text)].filter(char => char !== ' ' && char !== '\n' && char !== '\t');
            const tableBody = document.getElementById('symbolTableBody');
            tableBody.innerHTML = '';

            substitutionTable = {};
            reverseTable = {};

            uniqueChars.forEach(char => {
                const row = document.createElement('tr');
                
                const charCell = document.createElement('td');
                charCell.textContent = char;
                charCell.style.fontWeight = 'bold';
                
                const inputCell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'form-control form-control-sm';
                input.maxLength = 1;
                input.dataset.original = char;
                input.addEventListener('input', function(e) {
                    substitutionTable[this.dataset.original] = this.value;
                    // Update reverse mapping for decryption
                    if (this.value) {
                        reverseTable[this.value] = this.dataset.original;
                    }
                    updateButtonsState();
                });
                
                inputCell.appendChild(input);
                row.appendChild(charCell);
                row.appendChild(inputCell);
                tableBody.appendChild(row);
            });

            updateButtonsState();
            document.getElementById('saveTableBtn').disabled = false;
        }

        // Function to update buttons state
        function updateButtonsState() {
            const allFilled = Object.values(substitutionTable).every(value => value !== '');
            document.getElementById('encryptBtn').disabled = !allFilled;
            document.getElementById('decryptBtn').disabled = !allFilled;
        }

        // Function to encrypt text
        function encryptText() {
            const text = document.getElementById('inputText').value;
            let encrypted = '';
            
            for (const char of text) {
                if (substitutionTable[char]) {
                    encrypted += substitutionTable[char];
                } else {
                    encrypted += char;
                }
            }
            
            document.getElementById('outputText').value = encrypted;
            lastOperation = 'encrypt';
            
            // Update mode indicator
            const indicator = document.getElementById('modeIndicator');
            indicator.textContent = currentLang === 'ru' ? 'Зашифровано' : 'Encrypted';
            indicator.className = 'mode-indicator mode-encrypt';
            indicator.classList.remove('d-none');
        }

        // Function to decrypt text
        function decryptText() {
            const text = document.getElementById('inputText').value;
            let decrypted = '';
            
            for (const char of text) {
                if (reverseTable[char]) {
                    decrypted += reverseTable[char];
                } else {
                    decrypted += char;
                }
            }
            
            document.getElementById('outputText').value = decrypted;
            lastOperation = 'decrypt';
            
            // Update mode indicator
            const indicator = document.getElementById('modeIndicator');
            indicator.textContent = currentLang === 'ru' ? 'Дешифровано' : 'Decrypted';
            indicator.className = 'mode-indicator mode-decrypt';
            indicator.classList.remove('d-none');
        }

        // Function to save substitution table
        function saveSubstitutionTable() {
            const tableName = prompt(
                currentLang === 'ru' ? 'Введите название для таблицы:' : 'Enter name for table:',
                'custom_table'
            );
            
            if (tableName && tableName.trim() !== '') {
                presetTables[tableName] = {...substitutionTable};
                alert(
                    currentLang === 'ru' 
                    ? `Таблица "${tableName}" сохранена!` 
                    : `Table "${tableName}" saved!`
                );
            }
        }

        // Function to load preset table
        function loadPresetTable(presetName) {
            if (presetName === 'clear') {
                substitutionTable = {};
                reverseTable = {};
                document.getElementById('symbolTableBody').innerHTML = '';
                updateButtonsState();
                return;
            }

            if (!presetTables[presetName]) {
                alert(currentLang === 'ru' ? 'Таблица не найдена!' : 'Table not found!');
                return;
            }

            substitutionTable = {...presetTables[presetName]};
            // Build reverse mapping for decryption
            reverseTable = {};
            for (const [key, value] of Object.entries(substitutionTable)) {
                reverseTable[value] = key;
            }
            
            const tableBody = document.getElementById('symbolTableBody');
            tableBody.innerHTML = '';

            Object.entries(presetTables[presetName]).forEach(([original, replacement]) => {
                const row = document.createElement('tr');
                
                const charCell = document.createElement('td');
                charCell.textContent = original;
                charCell.style.fontWeight = 'bold';
                
                const inputCell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'form-control form-control-sm';
                input.value = replacement;
                input.maxLength = 1;
                input.dataset.original = original;
                input.addEventListener('input', function(e) {
                    substitutionTable[this.dataset.original] = this.value;
                    // Update reverse mapping for decryption
                    if (this.value) {
                        reverseTable[this.value] = this.dataset.original;
                    }
                    updateButtonsState();
                });
                
                inputCell.appendChild(input);
                row.appendChild(charCell);
                row.appendChild(inputCell);
                tableBody.appendChild(row);
            });

            updateButtonsState();
            document.getElementById('saveTableBtn').disabled = false;
        }

        // Function to clear input field
        function clearInput() {
            document.getElementById('inputText').value = '';
        }

        // Function to clear output field
        function clearOutput() {
            document.getElementById('outputText').value = '';
            document.getElementById('modeIndicator').classList.add('d-none');
        }

        // Initialize events
        document.addEventListener('DOMContentLoaded', function() {
            // Set theme from localStorage or default to light
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                isDarkTheme = true;
                document.body.classList.add('dark-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="bi bi-sun-fill"></i>';
            }

            // Detect language
            const detectedLang = detectLanguage();
            changeLanguage(detectedLang);

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);

            // Language switcher
            document.querySelectorAll('.language-switcher .btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    changeLanguage(this.getAttribute('data-lang'));
                });
            });

            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', analyzeText);

            // Encrypt button
            document.getElementById('encryptBtn').addEventListener('click', encryptText);

            // Decrypt button
            document.getElementById('decryptBtn').addEventListener('click', decryptText);

            // Save table button
            document.getElementById('saveTableBtn').addEventListener('click', saveSubstitutionTable);

            // Clear buttons
            document.getElementById('clearInput').addEventListener('click', clearInput);
            document.getElementById('clearOutput').addEventListener('click', clearOutput);

            // Preset tables
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    loadPresetTable(this.getAttribute('data-preset'));
                });
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
